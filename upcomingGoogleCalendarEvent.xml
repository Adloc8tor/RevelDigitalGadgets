<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Adloc8tor Upcoming Google Calendar Events Gadget" description="Displays the next event in a Google Calendar" author="Adloc8tor" background="transparent">
  	<Locale messages="https://adloc8tor.github.io/RevelDigitalGadgets/monthlyGoogleCalendar.lang.xml"/>
  	<UserPref name="apiKey" display_name="Google Developer Key" datatype="string" />
  	<UserPref name="calendarID" display_name="Google Calendar ID" datatype="string" />

    <UserPref name="DateStyle" display_name="Date Style" datatype="style" required="true" default-value="font-size:132pt;" />
    <UserPref name="DayOfWeekStyle" display_name="Day Of Week Style" datatype="style" required="true" default-value="font-size:32pt;" />    
    <UserPref name="DescriptionStyle" display_name="Description Style" datatype="style" required="true" default-value="" />
    <UserPref name="BookedTimeStyle" display_name="Booked Time Style" datatype="style" required="true" default-value="" />
  </ModulePrefs>
  <Content type="html">
<![CDATA[
<style type="text/css">
body *
{
  line-height: 1.2em; 
  letter-spacing: 0; 
  word-spacing: normal;
}
body
{
  overflow: hidden;
  background: transparent;
}

div#futureEvents {
  text-align:center;
}

span#date {
  display:block;
  line-height:1.0em;
  __UP_DateStyle__;
}

span#dayOfWeek {
  display:block;
  __UP_DayOfWeekStyle__;
}

span#description {
  display:block;
  __UP_DescriptionStyle__;
}

span#bookedTime {
  display:block;
  __UP_BookedTimeStyle__;
}

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/moment-with-langs.min.js" type="text/javascript"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/moment-timezone-with-data.js" type="text/javascript"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/simpledateformat.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenLite.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/utils/Draggable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/plugins/CSSPlugin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/plugins/ScrollToPlugin.min.js"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/autoscroll.js" type="text/javascript"></script>
<script src="https://reveldigital.github.io/gadget-common/utils.js" type="text/javascript"></script>
<script src="https://www.google.com/jsapi" type="text/javascript"></script>

<div id="futureEvents">
  <span style="color:#fff;">Testing, Testing, 1...2...3...</span><br />
  <span id="date"></span>
  <span id="dayOfWeek"></span>
  <span id="description"></span>
  <span id="bookedTime"></span>
</div>

<script type="text/javascript">
  var prefs = new gadgets.Prefs();
  
  function load() {
    
//    WebFont.load({
//      google: {
//        families: [
//          RevelDigital.getFamilyName(prefs.getString("header-style"))
//        ]
//      }
//    });
//    WebFont.load({
//      google: {
//        families: [
//          RevelDigital.getFamilyName(prefs.getString("body-style"))
//        ]
//      }
//    });

moment.lang("__MSG_Lang__");
   
    
    if (typeof Client != "undefined" && typeof(Client.getDeviceTimeZoneName) == "function") {
      moment.tz.setDefault(Client.getDeviceTimeZoneName());
    }
   
   	// Update the content on the screen every 2 minutes.
   	update();
   	setInterval(update, 120000);
   }
   
  gadgets.util.registerOnLoadHandler(load);
</script>
<script type="text/javascript">
  
  function update() {
    var currentDate = new Date();

    $('span#bookedTime').html('update in progress');

    $.ajax({
      type:'get',
      url:'https://www.googleapis.com/calendar/v3/calendars/adloc8tor.com_61rquem5odbvdn8es98nh0uedc@group.calendar.google.com/events?key=AIzaSyDN8dkir1si9vMwWJYz64YCsUIhFustgL8&orderBy=startTime&singleEvents=true&timeMin=' + encodeURI(currentDate.toISOString()),
      success: function(data,textStatus,jqXHR) {
  
        $('span#bookedTime').html('it worked');
  
  if(data.items == null || !(data.items instanceof Array) || data.items.length < 1) {
    $('span#date').html(' ');
		$('span#dayOfWeek').html('No future events planned');
  } else {
    var dayOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday','Saturday'];

  var startDate = new Date(data.items[0].start.dateTime);
	$('span#date').html(startDate.getDate());
  $('span#dayOfWeek').html(dayOfWeek[startDate.getDay()]);
	$('span#description').html(data.items[0].summary);
  
  var endDate = new Date(data.items[0].end.dateTime);
  $('span#bookedTime').html(('0' + startDate.getHours()).slice(-2) + ":" + ('0' + startDate.getMinutes()).slice(-2) + ' - ' + ('0' + endDate.getHours()).slice(-2) + ":" + ('0' + endDate.getMinutes()).slice(-2));
  }
  },
  error: function() {
  $('span#bookedTime').html('it failed!!!!!!!!!!!');
  }
});

    
  }
</script>
]]>
</Content></Module>
